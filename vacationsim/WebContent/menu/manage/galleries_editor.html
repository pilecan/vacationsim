<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>jQuery UI Accordion - Sortable</title>
<!-- link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"-->
<link rel="stylesheet"
	href="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.11/themes/ui-lightness/jquery-ui.css">
<link rel="stylesheet" href="../css/manager.css">

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script type='text/javascript' src='../js/util.js'></script>
<script type='text/javascript' src='../js/util_db.js'></script>
<script type='text/javascript' src='../js/galleries_init.js'></script>
<script type='text/javascript' src='../js/menu_galleries.js'></script>
<script type='text/javascript' src="../js/accordion/setAccordion.js"></script>

  
 
<script>
let currentGalleries = "";
let currentGallery = "";
let currentAccorion = "";

	$(function() {
	    $('#help').click(function(){
	        $('#overlay').fadeIn(200,function(){
	            $('#box').animate({'top':'20px'},200);
	        });
	        return false;
	    });
	    $('#boxclose').click(function(){
	        $('#box').animate({'top':'-300px'},500,function(){
	            $('#overlay').fadeOut('fast');
	        });
	    });
	 
	});


	function closeSave(){
		window.parent.$("#dialog").dialog('close');
	}
	function closeQuit(){
		window.parent.$("#dialog").dialog('close');
	}

	function addGallery(){
		console.log(currentAccorion+" - "+currentAccorion.length);
	}

	function deleteGallery(){
		console.log(currentAccorion+" - "+currentAccorion.length);
	}
	
	function resetAccordion(){
		resetSession(currentGalleries)
		let request = currentGalleries+"-"+currentGallery;
		if (currentGallery == undefined ){
			request = currentGalleries;
		} 

		window.parent.document.getElementById('accordionIframe').setAttribute("src", "./galleries_editor.html?g=" + request);
		window.parent.document.getElementById("accordionIframe").click();
		
	    window.sessionStorage.setItem("changed",false);
	}
	
	$(function() {
		$("#accordion")

		.accordion({
			header : "> div > h3",
			collapsible : true,
			active : false,
			autoHeight : true,
			heightStyle : "content",

		})
		.accordion({ activate: function(event, ui) {
			currentAccorion = ui.newHeader.text();
		}
		}).sortable({
			axis : "y",
			handle : "h3",
			stop : function(event, ui) {
				ui.item.children("h3").triggerHandler("focusout");
				setNewSession(currentGalleries, currentGallery);
				window.sessionStorage.setItem("changed",true);
				$(this).accordion("refresh");
			},
			beforeStop : function(event, ui) {
				 $(this).data("lastItem", ui.item);
				    var activeAccordion=$( "#accordion" ).accordion( "option", "active" );
				    var active = $( ".selector" ).accordion( "option", "active" );
				    var text= $("#accordion h3").eq(active).text();
			},
			change: function (event, ui) {
	             var activeIndex = $("#accordion").accordion("option", "active");
	                var hidId = $("#accordion input[type=hidden][class=HiddenId]")[activeIndex];
	       }
		});
	});
	
	

</script>
</head>
<body>
	<div>
		<div id="accordion" class="accordion blocks1">
			<div class="group">
				<h3>Section 1</h3>
				<div>
					<p>Mauris mauris ante,
				</div>
			</div>
		</div>
		<div class="blocks2">
			<div class="btn-group" style="width:100%">
			  <button style="width:17%" onclick="closeSave()">Save</button>
			  <button style="width:17%" onclick="addGallery()">Add</button>
			  <button style="width:17%" onclick="deleteGallery()">Delete</button>
			  <button style="width:17%" onclick="resetAccordion()">Reset</button>
			  <button style="width:17%" onclick="closeQuit()">Quit</button>
			  <button id="help" style="width:10%">?</button>
			</div>
			<div class="overlay" id="overlay" style="display:none;"></div>
			 
		</div>
		<div class="box" id="box">
		 <a class="boxclose" id="boxclose"></a>
		 <h2>Help!</h2>
		 <p>
		  <li>Drag & Drop title to Change Order
		  <li>Click on Title to Open and Modify
		  <li>Click Save/Quit and Record Modifications and 
		  <li>Click Reset to Cancel Modifications
		  <li>Click Quit and Cancel Modifications
		  <li>Click ? for Help (this)
		 </p>
		</div>
	</div>
	<script>
	
	
		$(document).ready(function() {
			currentGalleries = getParameterByName("g");

			let array = currentGalleries.split("-");
			currentGalleries = array[0].toLowerCase();
			currentGallery = array[1];
			
			setAccordionFromSession(currentGalleries, currentGallery);

		$("#dialog").dialog('option', 'title', currentGalleries);

		});
	</script>
</body>
</html>