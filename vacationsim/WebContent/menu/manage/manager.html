<!DOCTYPE html>
<html>

<head>
  <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
  <title>JS Bin</title>

  <style type="text/css">
    .iframe.none {
      border-style: none;
    }
  </style>

  <script src="../js/util.js"></script>
<script type='text/javascript' src='../js/util_db.js'></script>
<script type='text/javascript' src='../js/galleries_init.js'></script>
<script type='text/javascript' src='../js/menu_galleries.js'></script>
<script type='text/javascript' src="../js/accordion/setAccordion.js"></script>


  <script>
  
  function wait(ms) {
		var d = new Date();
		var d2 = null;
		do {
			d2 = new Date();
		}
		while (d2 - d < ms);
	}
  
    $(function () {
      $("#dialog").dialog({
        autoOpen: true,
        show: "fade",
        hide: "fade",
        modal: true,
        height: 'auto',
        width: 'auto',
        resizable: false,
        title: 'Welcome',
        open: function (ev, ui) {
          $('#accordionIframe').src;
          
        },
        close: function (ev, ui) {
          //$("#button-sim").parent().click();
         //window.parent.document.getElementById("button-sim").click();
         $("#button-sim", window.parent.document).click();
         $("#button-sim", window.parent.document).click();

         // wait(500);

         // $("#menu_items").parent().show();
         // window.parent.document.getElementById("menu_items").show();
         $("#menu_items", window.parent.document).show();

         // $("#button-sim").parent().show();
         // window.parent.document.getElementById("button-sim").show();
         $("#button-sim", window.parent.document).show();
         

         

        },
        beforeClose: function closeDialog() {
            //alert('Closing Dialog Now...');
            console.log( "xxx--->"+ window.sessionStorage.getItem("currentGalleries"));
            
            if (window.sessionStorage.getItem("changed") == "true")  {
            	
            	if (confirm("Do want to save your modification(s)?")){
    	           	 updateDB(window.sessionStorage.getItem("currentGalleries"));
 
    	           	 //remove temp
					let obj = (window.sessionStorage.getItem("temp|0"));
					let index = 0;
					while (obj != null && obj != undefined) {
						window.sessionStorage.removeItem("temp|"+index)
						index++;
						console.log(index)
						obj = window.sessionStorage.getItem("temp|"+index)
					}
					
					window.sessionStorage.removeItem("temp-"+window.sessionStorage.getItem("currentGalleries"));
    	           	 
    	             console.log(window.sessionStorage.getItem("currentGalleries")+ " galleries saved : "+window.parent.document.getElementById("gallery_name").innerHTML + window.sessionStorage.getItem("changed"));
    	     	     window.sessionStorage.setItem("changed",false);
    	             
    	             window.parent.document.getElementById("gallery_name").innerHTML=jsUcfirst(window.sessionStorage.getItem("currentGalleries"));
            		
            	} else {
            		currentGalleries = window.sessionStorage.getItem("currentGalleries");
                
    	           	 //transfert and remove temp
					let key = currentGalleries + "|0";
					let obj = (window.sessionStorage.getItem("temp|0"));
				
					let index = 0;
					while (obj != null && obj != undefined) {
						window.sessionStorage.setItem(key,obj)
						window.sessionStorage.removeItem("temp|"+index)
						index++;
						obj = (window.sessionStorage.getItem("temp|"+index));
						key = currentGalleries + "|" + index;
					}
					
					obj = window.sessionStorage.getItem("temp-"+currentGalleries);
					window.sessionStorage.setItem("menuGalleries-"+currentGalleries,obj);
					window.sessionStorage.removeItem("temp-"+currentGalleries);

					setMenuGallery(currentGalleries); 
					
            		//parent.location.reload(true);
            		
            		//window.parent.location = url;

            		
            	}
            	
            }
           	 
           	 
            
       }
      });

      $("#opener").click(function () {
        $("#dialog").dialog("open");
        return false;
      });
    });
  </script>
</head>

<body>
  <div id="dialog">
    <iframe id="accordionIframe" class="none" src=""  width="600" height="300"></iframe>
  </div>
  <script>
    $(document).ready(function () {
      let currentGalleries = getParameterByName("g");
      //console.log(currentGalleries)
	  document.getElementById('accordionIframe').setAttribute("src", "./galleries_editor.html?g=" + currentGalleries);
 	  document.getElementById("accordionIframe").click();
      $("#dialog").dialog('option', 'title', currentGalleries);

    });
  </script>


</body>

</html>